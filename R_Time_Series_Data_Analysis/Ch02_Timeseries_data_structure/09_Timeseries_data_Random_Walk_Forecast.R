##########################################################################################################################################

#(주의) ->  순차적으로 코드를 실행하는 것을 권함!

#에러 발생 시 github Time_Series_Analysis/R_Time_Series_Data_Analysis 경로에 issue를 남기면 확인

##########################################################################################################################################


### Random Walk Forest에 따른 예측과 평가의 분석사례.

# 시계열 자료 "dd"에 대하여, "rwf : Random Walk With Drift Forecast" 예측모형을 적용하여, 이에 따른 평가지표를 분석사례로 산정.



.libPaths("C://Users//yjang//R")                                              # 저장 디렉토리 및 lib 경로 설정.

install.packages("forecast")



dd = matrix(c(1342, 1442, 1252, 1343,  1425, 1362, 1456,1272,
              1243, 1359, 1412, 1253,  1201, 1478, 1322, 1406,
              1254, 1289, 1497, 1208))

(dd.ts =ts(data = dd, start = c(2006,1), frequency = 4))                      # 시계열 자료 입력.


ff.ts = rwf(dd.ts)                                                            # Random Walk Forecast
 
ff.ts                                                                         # rwf 분석결과


plot(ff.ts)

graphics.off()                                                                # 그래프 지워주는 함수.



accuracy(ff.ts)                                                               # 예측 결과의 지표.

qq1 = matrix(dd.ts)                                                           # 입력자료 matrix 변환.

qq2 = matrix(ff.ts$fitted)                                                    # 예측결과 matrix 변환.

qq3 = matrix(ff.ts$residuals)                                                 # 예측오차 matrix 변환.

qq1

qq2

qq3


qq1 = qq1[-1,]                                                                # 첫 번째 값을 제외

qq1

qq2 = qq2[-1,]                                                                # 첫 번째 값을 제외

qq2

qq3 = qq3[-1,]                                                                # 첫 번째 값을 제외

qq3


mean(qq3)                                                                     # ME 값 산정.

sqrt(mean(qq3^2))                                                             # RMSE 값 산정.

mean(abs(qq3))                                                                # MAE 값 산정.

mean(qq3/qq1*100)                                                             # MPE 값 산정.

mean(abs(qq3/qq1*100))                                                        # MAPE 값 산정.


############################################################결과값(print)#################################################################


#***출력값***


# # # > dd = matrix(c(1342, 1442, 1252, 1343,  1425, 1362, 1456,1272,
# +               1243, 1359, 1412, 1253,  1201, 1478, 1322, 1406,
# +               1254, 1289, 1497, 1208))
# > 
#   > (dd.ts =ts(data = dd, start = c(2006,1), frequency = 4))                      # 시계열 자료 입력.
# Qtr1 Qtr2 Qtr3 Qtr4
# 2006 1342 1442 1252 1343
# 2007 1425 1362 1456 1272
# 2008 1243 1359 1412 1253
# 2009 1201 1478 1322 1406
# 2010 1254 1289 1497 1208
# > 
#   > 
#   > ff.ts = rwf(dd.ts)                                                            # Random Walk Forecast
# >  
#   > ff.ts                                                                         # rwf 분석결과
# Point Forecast     Lo 80    Hi 80    Lo 95    Hi 95
# 2011 Q1           1208 1019.2633 1396.737 919.3521 1496.648
# 2011 Q2           1208  941.0860 1474.914 799.7902 1616.210
# 2011 Q3           1208  881.0984 1534.902 708.0472 1707.953
# 2011 Q4           1208  830.5266 1585.473 630.7042 1785.296
# 2012 Q1           1208  785.9719 1630.028 562.5637 1853.436
# 2012 Q2           1208  745.6914 1670.309 500.9600 1915.040
# 2012 Q3           1208  708.6496 1707.350 444.3095 1971.691
# 2012 Q4           1208  674.1720 1741.828 391.5805 2024.420
# 2013 Q1           1208  641.7899 1774.210 342.0563 2073.944
# 2013 Q2           1208  611.1621 1804.838 295.2152 2120.785
# > 
#   > 
#   > plot(ff.ts)
# 
# 
# > accuracy(ff.ts)                                                               # 예측 결과의 지표.
# ME    RMSE      MAE       MPE     MAPE     MASE       ACF1
# Training set -7.052632 147.272 127.0526 -1.154123 9.526336 1.192283 -0.4634665
# 
# 
# > qq1 = matrix(dd.ts)                                                           # 입력자료 matrix 변환.
# > 
#   > qq2 = matrix(ff.ts$fitted)                                                    # 예측결과 matrix 변환.
# > 
#   > qq3 = matrix(ff.ts$residuals)                                                 # 예측오차 matrix 변환.
# > 
#   > qq1
# [,1]
# [1,] 1342
# [2,] 1442
# [3,] 1252
# [4,] 1343
# [5,] 1425
# [6,] 1362
# [7,] 1456
# [8,] 1272
# [9,] 1243
# [10,] 1359
# [11,] 1412
# [12,] 1253
# [13,] 1201
# [14,] 1478
# [15,] 1322
# [16,] 1406
# [17,] 1254
# [18,] 1289
# [19,] 1497
# [20,] 1208
# > 
#   > qq2
# [,1]
# [1,]   NA
# [2,] 1342
# [3,] 1442
# [4,] 1252
# [5,] 1343
# [6,] 1425
# [7,] 1362
# [8,] 1456
# [9,] 1272
# [10,] 1243
# [11,] 1359
# [12,] 1412
# [13,] 1253
# [14,] 1201
# [15,] 1478
# [16,] 1322
# [17,] 1406
# [18,] 1254
# [19,] 1289
# [20,] 1497
# > 
#   > qq3
# [,1]
# [1,]   NA
# [2,]  100
# [3,] -190
# [4,]   91
# [5,]   82
# [6,]  -63
# [7,]   94
# [8,] -184
# [9,]  -29
# [10,]  116
# [11,]   53
# [12,] -159
# [13,]  -52
# [14,]  277
# [15,] -156
# [16,]   84
# [17,] -152
# [18,]   35
# [19,]  208
# [20,] -289
# 
# > qq1
# [1] 1442 1252 1343 1425 1362 1456 1272 1243 1359 1412 1253 1201 1478 1322 1406 1254 1289 1497 1208
# > qq2 = qq2[-1,]                                                                # 첫 번째 값을 제외
# > qq2
# [1] 1342 1442 1252 1343 1425 1362 1456 1272 1243 1359 1412 1253 1201 1478 1322 1406 1254 1289 1497
# > qq3 = qq3[-1,]                                                                # 첫 번째 값을 제외
# > qq3
# [1]  100 -190   91   82  -63   94 -184  -29  116   53 -159  -52  277 -156   84 -152   35  208 -289
# 
# 
# > mean(qq3)                                                                     # ME 값 산정.
# [1] -7.052632
# > 
#   > sqrt(mean(qq3^2))                                                             # RMSE 값 산정.
# [1] 147.272
# > 
#   > mean(abs(qq3))                                                                # MAE 값 산정.
# [1] 127.0526
# > 
#   > mean(qq3/qq1*100)                                                             # MPE 값 산정.
# [1] -1.154123
# > 
#   > mean(abs(qq3/qq1*100))                                                        # MAPE 값 산정.
# [1] 9.526336

##########################################################################################################################################